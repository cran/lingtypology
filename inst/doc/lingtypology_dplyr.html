<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="George Moroz" />

<meta name="date" content="2024-09-21" />

<title>lingtypology and other packages</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore"><code>lingtypology</code> and other
packages</h1>
<h4 class="author">George Moroz</h4>
<h4 class="date">2024-09-21</h4>



<div id="dplyr-and-pipe" class="section level3">
<h3>1. <code>dplyr</code> and pipe <code>|&gt;</code></h3>
<p>It is possible to use <a href="https://github.com/tidyverse/dplyr"><code>dplyr</code></a>
functions and pipes with <code>lingtypology</code>. It is widely used,
so I will give some examples, how to use it with
the<code>lingtypology</code> package. Using query “list of languages
csv” I found Vincent Garnier’s <a href="https://github.com/forxer/languages-list">languages-list
repository</a>. Let’s download and map all the languages from that set.
First download the data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://goo.gl/GgscBE&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">tail</span>(new_data)</span></code></pre></div>
<p>As we see, some values of the <code>Language.name</code> variable
contain more than one language name. Some of the names probably have
different names in our database. Imagine that we want to map all
languages from Africa. So that the following examples work correctly,
use <code>library(dplyr)</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>new_data <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Language.name =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot; &quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>, Language.name)) <span class="sc">|&gt;</span>  </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.glottolog</span>(Language.name) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">area.lang</span>(Language.name) <span class="sc">==</span> <span class="st">&quot;Africa&quot;</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="fu">select</span>(Language.name) <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="fu">map.feature</span>()</span></code></pre></div>
<p>We start with a dataframe, here a <code>new_data</code>. First we
remove spaces at the end of each string. Then we check, whether the
language names are in the glottolog database. Then we select only rows
that contain languages of Africa. Then we select the
<code>Language.name</code> variable. And the last line maps all selected
languages.</p>
<p>By default, the values that came from the pipe are treated as the
first argument of a function. But when there are some additional
arguments, underline sign specify what exact position should be piped
to. Let’s produce the same map with a minimap.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>new_data <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Language.name =</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot; &quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>, Language.name)) <span class="sc">|&gt;</span>  </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.glottolog</span>(Language.name) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">area.lang</span>(Language.name) <span class="sc">==</span> <span class="st">&quot;Africa&quot;</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">select</span>(Language.name) <span class="sc">|&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">map.feature</span>(<span class="at">languages =</span> _, <span class="at">minimap =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="leaflet-leaflet.extras-mapview-mapedit" class="section level3">
<h3>2. <code>leaflet</code>, <code>leaflet.extras</code>,
<code>mapview</code>, <code>mapedit</code></h3>
<p>There is also a possibility to use <code>lingtypology</code> with
other <a href="https://github.com/rstudio/leaflet"><code>leaflet</code></a>
functions (thanks to <a href="https://github.com/nikopartanen">Niko
Partanen</a> for the idea):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">map.feature</span>(<span class="fu">c</span>(<span class="st">&quot;French&quot;</span>, <span class="st">&quot;Occitan&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">fitBounds</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="dv">10</span>, <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">addPopups</span>(<span class="dv">2</span>, <span class="dv">48</span>, <span class="st">&quot;Great day!&quot;</span>)</span></code></pre></div>
<p>If you add <code>leaflet</code> arguments befor
<code>map.feature</code> function, you need to use argument
<code>pipe.data = _</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">fitBounds</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="dv">10</span>, <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">addPopups</span>(<span class="dv">2</span>, <span class="dv">48</span>, <span class="st">&quot;Great day!&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="fu">map.feature</span>(<span class="fu">c</span>(<span class="st">&quot;French&quot;</span>, <span class="st">&quot;Occitan&quot;</span>), <span class="at">pipe.data =</span> _)</span></code></pre></div>
<p>The other usage of this <code>pipe.data</code> argument is to put
there a variable with a <code>leaflet</code> object:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">fitBounds</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="dv">10</span>, <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">addPopups</span>(<span class="dv">2</span>, <span class="dv">48</span>, <span class="st">&quot;Great day!&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">map.feature</span>(<span class="fu">c</span>(<span class="st">&quot;French&quot;</span>, <span class="st">&quot;Occitan&quot;</span>), <span class="at">pipe.data =</span> m)</span></code></pre></div>
<p>If you want to define tiles in <code>leaflet</code> part, you need to
change tile argument in <code>map.feature</code> function, because the
default value for the <code>tile</code> argument is
“OpenStreetMap.Mapnik”.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">leaflet</span>()  <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">&quot;Stamen.TonerLite&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">fitBounds</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="dv">10</span>, <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">addPopups</span>(<span class="dv">2</span>, <span class="dv">48</span>, <span class="st">&quot;Great day!&quot;</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">map.feature</span>(<span class="fu">c</span>(<span class="st">&quot;French&quot;</span>, <span class="st">&quot;Occitan&quot;</span>), <span class="at">pipe.data =</span> _, <span class="at">tile =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>It is also possible to use some tools provided by <a href="https://github.com/RCura/leaflet.extras"><code>leaflet.extras</code>
package</a>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">map.feature</span>(<span class="fu">c</span>(<span class="st">&quot;French&quot;</span>, <span class="st">&quot;Occitan&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  leaflet.extras<span class="sc">::</span><span class="fu">addDrawToolbar</span>()  <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  leaflet.extras<span class="sc">::</span><span class="fu">addStyleEditor</span>()</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="fu">map.feature</span>(<span class="fu">c</span>(<span class="st">&quot;French&quot;</span>, <span class="st">&quot;Occitan&quot;</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  leaflet.extras<span class="sc">::</span><span class="fu">addFullscreenControl</span>()</span></code></pre></div>
<p>Also there is a nice package <code>mapedit</code> that provide a
possibility of creating and editing of leaflet objects by hand:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">map.feature</span>(<span class="fu">c</span>(<span class="st">&quot;West Circassian&quot;</span>, <span class="st">&quot;Russian&quot;</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  mapedit<span class="sc">::</span><span class="fu">editMap</span>() <span class="ot">-&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  my_polygone</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="fu">map.feature</span>(<span class="fu">c</span>(<span class="st">&quot;West Circassian&quot;</span>, <span class="st">&quot;Russian&quot;</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">addPolygons</span>(<span class="at">data =</span> my_polygone<span class="sc">$</span>finished)</span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/ropensci/lingtypology/master/docs/use_mapedit.gif" /></p>
</div>
<div id="combining-maps-in-a-grid-and-facetisation-with-mapview" class="section level3">
<h3>3. Combining maps in a grid and facetisation with
<code>mapview</code></h3>
<p>The <a href="https://github.com/r-spatial/leafsync"><code>leafsync</code>
package</a> provides a possibility to create a multiple maps in a grid
and even synchronise them. There are two functions for that:
<code>latticeview()</code> and <code>sync()</code>. Facetisation is a
really powerfull tool (look for <code>facet_grid()</code> and
<code>facet_wrap()</code> functions from <code>ggplot2</code>).
<code>lingtypology</code> doesn’t provide a facetisation itself, but the
<code>facet</code> argument of the <code>map.feature()</code> function
create a list of maps based on this variable. The result of the work of
this function then is changed: instead of creating a map in Viewer pane
it will return a list that could be used in <code>latticeview()</code>
and <code>sync()</code> functions from the <code>leafsync</code>
package.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>faceted <span class="ot">&lt;-</span> <span class="fu">map.feature</span>(circassian<span class="sc">$</span>language,</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                       <span class="at">latitude =</span> circassian<span class="sc">$</span>latitude,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                       <span class="at">longitude =</span> circassian<span class="sc">$</span>longitude,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>                       <span class="at">features =</span> circassian<span class="sc">$</span>dialect,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>                       <span class="at">facet =</span> circassian<span class="sc">$</span>language)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="fu">library</span>(leafsync)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="fu">sync</span>(faceted, <span class="at">no.initial.sync =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>As you can see we provided a <code>circassian$language</code> to the
<code>facet</code> argument, so it returned a list of two maps that
stored in <code>faceted</code> variable.</p>
<p>It is also possible to combine any maps that were created, just store
them in a variable, and combine them in <code>latticeview()</code> and
<code>sync()</code> functions</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">map.feature</span>(<span class="fu">lang.aff</span>(<span class="st">&quot;Tsezic&quot;</span>), <span class="at">label =</span> <span class="fu">lang.aff</span>(<span class="st">&quot;Tsezic&quot;</span>))</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">map.feature</span>(<span class="fu">lang.aff</span>(<span class="st">&quot;Avar-Andi&quot;</span>), <span class="at">label =</span> <span class="fu">lang.aff</span>(<span class="st">&quot;Avar-Andi&quot;</span>))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">sync</span>(m1, m2)</span></code></pre></div>
</div>
<div id="get-data-from-openstreetmap-with-overpass" class="section level3">
<h3>4. Get data from OpenStreetMap with <code>overpass</code></h3>
<p>This section is inspired by talk with <a href="https://github.com/nikopartanen">Niko Partanen</a> and his <a href="https://gist.github.com/nikopartanen/f5b4a325808ea8993bfb14b9f81cdfc1">gist</a>.
<a href="https://github.com/hrbrmstr/overpass">Overpass</a> is a packge
with tools to work with the OpenStreetMap (OSM) <a href="https://wiki.openstreetmap.org/wiki/Overpass_API">Overpass
API</a>. Explore simple Overpass queries with <a href="https://overpass-turbo.eu/">overpass turbo</a>. Imagine that we
need to get all settlements from Ingushetia, Daghestan and Chechnya. So,
first, load a library:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">library</span>(overpass)</span></code></pre></div>
<p>Create a query:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>settlements <span class="ot">&lt;-</span> <span class="st">&#39;area[name~&quot;Дагестан|Ингушетия|Чечня&quot;];</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="st">(node[&quot;place&quot;~&quot;city|village|town|hamlet&quot;](area););</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="st">out;&#39;</span></span></code></pre></div>
<p>Pass the query to <code>overpass_query()</code> function and change
the input result to dataframe:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>query_result <span class="ot">&lt;-</span> <span class="fu">overpass_query</span>(settlements)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>settlement_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(query_result[, <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;name&quot;</span>)])</span></code></pre></div>
<p>Some values could be <code>NA</code>, so I profer clean it with
<code>complete.cases()</code> function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>settlement_data <span class="ot">&lt;-</span> settlement_data[<span class="fu">complete.cases</span>(settlement_data),]</span></code></pre></div>
<p>On the last step, I will use a “fake” language argument to avoid the
creation of some Glottolog links:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">map.feature</span>(<span class="at">language =</span> <span class="st">&quot;fake&quot;</span>,</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>            <span class="at">latitude =</span> settlement_data<span class="sc">$</span>lat,</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>            <span class="at">longitude =</span> settlement_data<span class="sc">$</span>lon,</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>            <span class="at">label =</span> settlement_data<span class="sc">$</span>name)</span></code></pre></div>
<p>Results are not ideal: there are some villages Дагестанская and
Красный Дагестан in Adygeya and Krasnodarskiy district, but the most
points are correct. It is also possible to get all data from some
polygone created with <code>mapedit</code> (see previous section).</p>
</div>
<div id="create-your-own-atlas-with-rmarkdown" class="section level3">
<h3>5. Create your own atlas with <code>rmarkdown</code></h3>
<p>This section is inspired by talk with <a href="https://github.com/nikopartanen">Niko Partanen</a>. It is possible
to create an atlas website using <code>lingtypology</code> and <a href="https://github.com/rstudio/rmarkdown"><code>rmarkdown</code></a>
packages. The function <code>atlas.database()</code> creates a folder in
the working directory that contains an <code>rmarkdown</code> template
for a web-site.</p>
<p>First, lets create a <code>dataframe</code> with some data.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">wals.feature</span>(<span class="fu">c</span>(<span class="st">&quot;1a&quot;</span>, <span class="st">&quot;20a&quot;</span>))</span></code></pre></div>
<p>Second we can create a website using <code>atlas.database()</code>
function:</p>
<ul>
<li><code>languages</code> argument is a language list</li>
<li><code>features</code> argument is a data.frame with corresponding
features</li>
<li><code>latitude</code> and <code>longitude</code> arguments are
optional</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">atlas.database</span>(<span class="at">languages =</span> df<span class="sc">$</span>language,</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>               <span class="at">features =</span> df[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>)],</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>               <span class="at">latitude =</span> df<span class="sc">$</span>latitude,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>               <span class="at">longitude =</span> df<span class="sc">$</span>longitude,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>               <span class="at">atlas.name =</span> <span class="st">&quot;Some WALS features&quot;</span>,</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>               <span class="at">author =</span> <span class="st">&quot;Author Name&quot;</span>)</span></code></pre></div>
<p>We can see that this function creates a subfolder with following
files:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;./atlas_Some_WALS_features/&quot;</span>)</span></code></pre></div>
<p>The last step is to run a command:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">render_site</span>(<span class="st">&quot;./atlas_Some_WALS_features/&quot;</span>)</span></code></pre></div>
<p>Then the atlas website will be created (here is <a href="https://agricolamz.github.io/lingtypology_atlas_example/index.html">a
result</a>). If you want to change something in the website, just change
some files:</p>
<ul>
<li>write information about atlas in index.Rmd file</li>
<li>list citation information</li>
<li>change any <code>.Rmd</code> file</li>
<li>…</li>
<li>and on the end rerun the
<code>rmarkdown::render_site(&quot;./atlas_Some_WALS_features/&quot;)</code>
command.</li>
</ul>
</div>
<div id="create-.kml-file-using-sp-and-rgdal" class="section level3">
<h3>6. Create .kml file using <code>sp</code> and
<code>rgdal</code></h3>
<p>.kml file is a common file type for geospatial data. This kind of
files are used in <a href="https://en.wikipedia.org/wiki/Google_Earth">Google Earth</a>, <a href="https://github.com/pebbe/Gabmap">Gabmap</a> (a web application
that visualizes dialect variations) and others. In order to produce a
.kml file you need to have a dataset with coordinates such as
<code>circassian</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">coordinates</span>(circassian) <span class="ot">&lt;-</span> <span class="er">~</span>longitude<span class="sc">+</span>latitude</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">proj4string</span>(circassian) <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>rgdal<span class="sc">::</span><span class="fu">writeOGR</span>(circassian[<span class="st">&quot;village&quot;</span>],</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>                <span class="st">&quot;circassian.kml&quot;</span>, </span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>                <span class="at">layer=</span><span class="st">&quot;village&quot;</span>,</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>                <span class="at">driver=</span><span class="st">&quot;KML&quot;</span>)</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
